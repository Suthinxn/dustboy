{% extends "/base/default_page.html" %}

{% block title %} PODSAAD {% endblock title %}

{% block content %}
<div class="mx-auto px-4 py-8">
    <!-- Header Section -->
    <div class="text-center mb-8">
        <h2 class="text-4xl font-bold text-gray-800 mb-4">PM 2.5 Concentration Rankings</h2>
        <p class="text-gray-800 text-lg">Top 10 Provinces with Highest Air Pollution Levels (Southern Thailand)</p>
        <div class="flex justify-center mt-2">
            <div class="stats w-full bg-white/90 shadow-md rounded-xl">
                <div class="stat">
                    <div class="stat-figure text-primary">
                        <i class="fas fa-calendar-alt text-2xl"></i>
                    </div>
                    <div class="stat-title">Last Updated</div>
                    <div class="stat-value text-primary">Today</div>
                    <div class="stat-desc">2 hours ago</div>
                </div>
                <div class="stat">
                    <div class="stat-figure text-secondary">
                        <i class="fas fa-exclamation-triangle text-2xl"></i>
                    </div>
                    <div class="stat-title">Alert Level</div>
                    <div class="stat-value text-secondary">High</div>
                    <div class="stat-desc">7 provinces exceed safe limits</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div class="flex justify-center mb-8">
        <div class="bg-white/90 w-full rounded-2xl p-6 shadow-md">
            <h3 class="text-lg font-semibold mb-4 text-center text-gray-800">Air Quality Index Legend</h3>
            <div class="flex flex-wrap gap-4 justify-center">
                <div class="flex items-center space-x-2">
                    <div class="w-4 h-4 rounded-full good-level"></div>
                    <span class="text-sm font-medium">Good (0-50)</span>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="w-4 h-4 rounded-full moderate-level"></div>
                    <span class="text-sm font-medium">Moderate (51-100)</span>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="w-4 h-4 rounded-full warning-level"></div>
                    <span class="text-sm font-medium">Unhealthy (101-200)</span>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="w-4 h-4 rounded-full danger-level"></div>
                    <span class="text-sm font-medium">Hazardous (200+)</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Rankings List -->
        <div class="lg:col-span-2">
            <div class="bg-white/95 rounded-3xl shadow-2xl p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-ranking-star mr-3 text-blue-500"></i>
                        Province Rankings
                    </h3>
                    <div class="badge badge-error badge-lg">Live Data</div>
                </div>
                
                <div class="space-y-4" id="provinceList">
                    <!-- Province cards populated by JS -->
                </div>
            </div>
        </div>

        <!-- Side Panel -->
        <div class="space-y-6">
            <!-- Chart -->
            <div class="bg-white/95 rounded-3xl shadow-2xl p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-chart-pie mr-3 text-green-500"></i>
                    Concentration Overview
                </h3>
                <div id="pm25ApexChart" class="w-full h-64"></div>
            </div>

            <!-- Quick Stats -->
            <div class="bg-white/95 rounded-3xl shadow-2xl p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-info-circle mr-3 text-purple-500"></i>
                    Quick Stats
                </h3>
                <div class="space-y-4">
                    <div class="flex justify-between items-center p-3 bg-red-50 rounded-xl">
                        <span class="font-medium text-red-800">Highest Reading</span>
                        <span class="font-bold text-red-600">245 Œºg/m¬≥</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-blue-50 rounded-xl">
                        <span class="font-medium text-blue-800">Average</span>
                        <span class="font-bold text-blue-600">156 Œºg/m¬≥</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-green-50 rounded-xl">
                        <span class="font-medium text-green-800">Provinces > 100</span>
                        <span class="font-bold text-green-600">8 / 10</span>
                    </div>
                </div>
            </div>

            <!-- Health Advisory -->
            <div class="bg-gradient-to-r from-red-500 to-pink-500 rounded-3xl shadow-2xl p-6 text-white">
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-heartbeat mr-3"></i>
                    Health Advisory
                </h3>
                <div class="space-y-3 text-sm">
                    <p><i class="fas fa-exclamation-triangle mr-2"></i>High pollution levels detected</p>
                    <p><i class="fas fa-mask mr-2"></i>Wear protective masks outdoors</p>
                    <p><i class="fas fa-home mr-2"></i>Stay indoors when possible</p>
                    <p><i class="fas fa-running mr-2"></i>Limit outdoor activities</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
    // ‚úÖ Mock data ‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ
    let provinceData = [
        { name: "‡∏™‡∏á‡∏Ç‡∏•‡∏≤", value: 220, trend: "up", change: 10 },
        { name: "‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á", value: 190, trend: "down", change: -5 },
        { name: "‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä", value: 185, trend: "stable", change: 0 },
        { name: "‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ", value: 150, trend: "up", change: 8 },
        { name: "‡∏¢‡∏∞‡∏•‡∏≤", value: 140, trend: "down", change: -3 },
        { name: "‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™", value: 135, trend: "up", change: 6 },
        { name: "‡∏ï‡∏£‡∏±‡∏á", value: 130, trend: "down", change: -2 },
        { name: "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", value: 125, trend: "stable", change: 1 },
        { name: "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", value: 90, trend: "up", change: 5 },
        { name: "‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà", value: 50, trend: "down", change: -4 }
    ];

    // üé® ‡∏™‡∏µ + label ‡∏ï‡∏≤‡∏° AQI
    function getAQILevel(value) {
        if (value <= 50) return { class: 'good-level', text: 'Good', color: 'text-green-600' };
        if (value <= 100) return { class: 'moderate-level', text: 'Moderate', color: 'text-yellow-600' };
        if (value <= 200) return { class: 'warning-level', text: 'Unhealthy', color: 'text-orange-600' };
        return { class: 'danger-level', text: 'Hazardous', color: 'text-red-600' };
    }

    // üî∫ Trend icon
    function getTrendIcon(trend) {
        switch(trend) {
            case 'up': return '<i class="fas fa-arrow-up text-red-500"></i>';
            case 'down': return '<i class="fas fa-arrow-down text-green-500"></i>';
            default: return '<i class="fas fa-minus text-gray-500"></i>';
        }
    }

    // üìù Render Province Cards
    function renderProvinceList() {
        const list = document.getElementById('provinceList');
        list.innerHTML = '';

        provinceData.forEach((province, index) => {
            const aqi = getAQILevel(province.value);
            const card = document.createElement('div');
            card.className = 'province-card bg-white rounded-2xl p-4 shadow-xl hover:shadow-2xl border border-gray-100 transition-all duration-300 animate-fadeInUp';
            card.style.animationDelay = `${index * 0.1}s`;

            card.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="flex flex-col items-center">
                            <div class="w-12 h-12 rounded-full ${aqi.class} flex items-center justify-center text-white font-bold text-lg shadow-lg">
                                ${index + 1}
                            </div>
                            <div class="text-xs mt-1 font-medium ${aqi.color}">${aqi.text}</div>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-lg font-bold text-gray-800">${province.name}</h4>
                            <p class="text-sm text-gray-500">Province</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="flex items-center space-x-2 mb-1">
                            <span class="text-2xl font-bold text-gray-800">${province.value}</span>
                            <span class="text-sm text-gray-500">Œºg/m¬≥</span>
                            ${getTrendIcon(province.trend)}
                        </div>
                        <div class="text-xs ${province.change >= 0 ? 'text-red-500' : 'text-green-500'}">
                            ${province.change >= 0 ? '+' : ''}${province.change}% vs yesterday
                        </div>
                    </div>
                </div>
                <div class="mt-3">
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="${aqi.class} h-2 rounded-full transition-all duration-500" style="width: ${Math.min(province.value / 3, 100)}%"></div>
                    </div>
                </div>
            `;
            list.appendChild(card);
        });
    }

    // üìä Apex Pie Chart
    function createApexChart() {
        let good = 0, moderate = 0, unhealthy = 0, hazardous = 0;
        provinceData.forEach(p => {
            if (p.value <= 50) good++;
            else if (p.value <= 100) moderate++;
            else if (p.value <= 200) unhealthy++;
            else hazardous++;
        });

        const options = {
            chart: {
                type: 'pie',
                height: 250
            },
            labels: ['Good', 'Moderate', 'Unhealthy', 'Hazardous'],
            series: [good, moderate, unhealthy, hazardous],
            colors: ['#4caf50','#ffeb3b','#ffa726','#ff6b6b'],
            legend: {
                position: 'bottom',
                horizontalAlign: 'center'
            },
            tooltip: {
                y: {
                    formatter: function(val) {
                        return val + ' provinces';
                    }
                }
            }
        };

        const chart = new ApexCharts(document.querySelector("#pm25ApexChart"), options);
        chart.render();
    }

    // üîÑ Render ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    document.addEventListener('DOMContentLoaded', () => {
        renderProvinceList();
        createApexChart();
    });
</script>


<style>
.good-level { background-color: #4caf50; box-shadow: 0 0 4px rgba(0,0,0,0.2); }
.moderate-level { background-color: #ffeb3b; box-shadow: 0 0 4px rgba(0,0,0,0.2); }
.warning-level { background-color: #ffa726; box-shadow: 0 0 4px rgba(0,0,0,0.2); }
.danger-level { background-color: #ff6b6b; box-shadow: 0 0 4px rgba(0,0,0,0.2); }
.animate-fadeInUp { animation: fadeInUp 0.5s ease forwards; opacity: 0; }
@keyframes fadeInUp {
  from { transform: translateY(10px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
</style>


{% endblock %}
